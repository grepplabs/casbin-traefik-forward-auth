suite: ConfigMap env
templates:
  - configmap-env.yaml

release:
  name: casbin-forward-auth
  namespace: casbin-auth

tests:
  - it: should not render when application.env is empty
    template: configmap-env.yaml
    asserts:
      - notExists:
          path: kind

  - it: should render env ConfigMap when application.env is set
    template: configmap-env.yaml
    set:
      application:
        env:
          CASBIN_MODEL_PATH: /etc/casbin/model.conf
          CASBIN_POLICY_PATH: /etc/casbin/policy.csv
    asserts:
      - isKind:
          of: ConfigMap
      - equal:
          path: metadata.name
          value: casbin-forward-auth-env
      - equal:
          path: data.CASBIN_MODEL_PATH
          value: "/etc/casbin/model.conf"
      - equal:
          path: data.CASBIN_POLICY_PATH
          value: "/etc/casbin/policy.csv"
